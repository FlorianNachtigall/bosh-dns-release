groups:
- name: bosh-dns:docker
  jobs:
  - build-unit-tests-image
  - build-acceptance-tests-windows-image
  - build-acceptance-tests-image

jobs:
- name: build-acceptance-tests-image
  public: true
  serial: true
  plan:
  - in_parallel:
    - get: repo
      trigger: true
    - get: main-bosh-image
      trigger: true
  - put: acceptance-tests-image
    params:
      build: "repo/ci/docker/acceptance-tests"
- name: build-acceptance-tests-windows-image
  public: true
  serial: true
  plan:
  - get: repo
    trigger: true
  - put: acceptance-tests-windows-image
    params:
      build: "repo/ci/docker/acceptance-tests-windows"
- name: build-unit-tests-image
  public: true
  serial: true
  plan:
  - get: repo
    trigger: true
  - put: unit-tests-image
    params:
      build: "repo/ci/docker/unit-tests"

resources:
- name: repo
  type: git
  source:
    uri: https://github.com/cloudfoundry/bosh-dns-release.git
    branch: master
    paths:
    - "ci/docker"
- name: main-bosh-image
  type: registry-image
  source:
    repository: bosh/main-bosh-docker
- name: unit-tests-image
  type: registry-image
  source:
    repository: bosh/bosh-dns-release
    tag: unit-tests
    username: {{dockerhub_username}}
    password: {{dockerhub_password}}
- name: acceptance-tests-image
  type: registry-image
  source:
    repository: bosh/bosh-dns-release
    tag: acceptance-tests
    username: {{dockerhub_username}}
    password: {{dockerhub_password}}
- name: acceptance-tests-windows-image
  type: registry-image
  source:
    repository: bosh/bosh-dns-release
    tag: acceptance-tests-windows
    username: {{dockerhub_username}}
    password: {{dockerhub_password}}
